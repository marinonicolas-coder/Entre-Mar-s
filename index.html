<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Entre Mares 🌊💙</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 10px;
            font-size: 2em;
        }

        .subtitle {
            text-align: center;
            color: #888;
            margin-bottom: 30px;
            font-size: 0.9em;
        }

        .user-select {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }

        .user-btn {
            flex: 1;
            padding: 15px;
            border: 2px solid #667eea;
            background: white;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1em;
            font-weight: bold;
        }

        .user-btn:hover {
            background: #f0f4ff;
        }

        .user-btn.active {
            background: #667eea;
            color: white;
        }

        .question-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
        }

        .question-number {
            color: #667eea;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .question-text {
            font-size: 1.1em;
            margin-bottom: 20px;
            color: #333;
        }

        textarea {
            width: 100%;
            min-height: 100px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1em;
            resize: vertical;
            font-family: inherit;
        }

        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn-submit {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
            margin-top: 10px;
        }

        .btn-submit:hover {
            transform: translateY(-2px);
        }

        .btn-submit:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .answer-display {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
        }

        .answer-label {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .answer-text {
            color: #555;
            line-height: 1.6;
            white-space: pre-wrap;
        }

        .locked {
            opacity: 0.6;
            pointer-events: none;
        }

        .locked-message {
            background: #fff3cd;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            color: #856404;
            margin-bottom: 20px;
        }

        .progress {
            background: #e0e0e0;
            height: 8px;
            border-radius: 10px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .progress-bar {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            transition: width 0.3s;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            font-size: 0.8em;
            color: #888;
        }

        .connection-status {
            position: fixed;
            top: 10px;
            right: 10px;
            padding: 8px 15px;
            background: #28a745;
            color: white;
            border-radius: 20px;
            font-size: 0.8em;
            display: none;
            z-index: 1000;
        }

        .connection-status.connected {
            display: block;
        }

        .connection-status.disconnected {
            background: #dc3545;
            display: block;
        }

        .comparison-section {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
        }

        .comparison-title {
            text-align: center;
            font-size: 1.5em;
            color: #667eea;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .comparison-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .comparison-question {
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            font-size: 1.05em;
        }

        .comparison-answers {
            display: grid;
            gap: 15px;
        }

        .comparison-answer {
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .comparison-answer.nicolas {
            background: #e3f2fd;
            border-left-color: #2196F3;
        }

        .comparison-answer.carolina {
            background: #fce4ec;
            border-left-color: #E91E63;
        }

        .comparison-answer-label {
            font-weight: bold;
            margin-bottom: 8px;
            color: #667eea;
            font-size: 0.9em;
        }

        .comparison-answer-text {
            color: #555;
            line-height: 1.5;
        }

        .celebration {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .celebration h2 {
            font-size: 2em;
            margin-bottom: 15px;
        }

        .celebration p {
            font-size: 1.1em;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="connection-status" id="connectionStatus">Conectado 🟢</div>
    
    <div class="container">
        <h1>Entre Mares 🌊💙</h1>
        <p class="subtitle">50 perguntas para nos conhecermos melhor</p>

        <div class="user-select">
            <button class="user-btn" onclick="selectUser('NICOLAS')">Nicolás 🇦🇷</button>
            <button class="user-btn" onclick="selectUser('CAROLINA')">Carolina 🇧🇷</button>
        </div>

        <div id="statsContainer" style="display: none;">
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-number" id="nicolasAnswers">0</div>
                    <div class="stat-label">Nicolás</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="carolinaAnswers">0</div>
                    <div class="stat-label">Carolina</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="unlockedCount">0</div>
                    <div class="stat-label">Desbloqueadas</div>
                </div>
            </div>

            <div class="progress">
                <div class="progress-bar" id="progressBar" style="width: 0%"></div>
            </div>
        </div>

        <div id="questionsContainer"></div>
        <div id="comparisonContainer"></div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, set, onValue, get } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        const firebaseConfig = {
            apiKey: "AIzaSyB5tsh-p5N51QmLcD1g0_oAHyI0VkHF6u4",
            authDomain: "entre-mares-ad2aa.firebaseapp.com",
            databaseURL: "https://entre-mares-ad2aa-default-rtdb.firebaseio.com",
            projectId: "entre-mares-ad2aa",
            storageBucket: "entre-mares-ad2aa.firebasestorage.app",
            messagingSenderId: "980348350847",
            appId: "1:980348350847:web:07b5a2470a704f9d93ea4a"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        let currentUser = null;
        const gameRef = ref(database, 'game');

        const questions = [
            "O que te faz sentir mais vivo/a?",
            "Se você pudesse jantar com qualquer pessoa (viva ou morta), quem seria?",
            "Qual é o seu maior medo e por quê?",
            "Qual música te deixa nostálgico/a?",
            "Qual foi o melhor conselho que você recebeu?",
            "O que você gostaria que as pessoas soubessem sobre você?",
            "Qual é o seu lugar favorito no mundo?",
            "O que te faz rir sem falta?",
            "Qual foi o momento mais feliz da sua vida?",
            "O que você gostaria de aprender ou melhorar sobre si mesmo/a?",
            "Como você descreve o amor?",
            "Qual é o seu ritual matinal favorito?",
            "Qual livro ou filme mudou sua perspectiva de vida?",
            "Qual é a sua comida reconfortante?",
            "O que te motiva nos dias difíceis?",
            "Se você tivesse um superpoder, qual seria?",
            "Qual é a sua forma favorita de expressar amor?",
            "Quais valores são mais importantes para você?",
            "Qual foi o maior risco que você já tomou?",
            "O que significa família para você?",
            "Qual é a sua forma ideal de passar um domingo?",
            "O que te faz sentir grato/a?",
            "Qual é a sua maior conquista?",
            "O que você gostaria de fazer antes de morrer?",
            "Como você lida com conflitos em um relacionamento?",
            "Do que você precisa quando está triste?",
            "Qual é a sua definição de sucesso?",
            "Qual tradição familiar é importante para você?",
            "Qual é a sua forma favorita de demonstrar carinho?",
            "O que te faz sentir em casa?",
            "Qual foi uma lição difícil que você aprendeu?",
            "Qual sonho você ainda quer realizar?",
            "Como você relaxa depois de um dia estressante?",
            "Qual música você escuta quando está feliz?",
            "Qual é a sua maior insegurança?",
            "O que significa lealdade para você?",
            "Qual é a sua lembrança favorita da infância?",
            "O que te faz sentir mais conectado/a com alguém?",
            "Como você gostaria de crescer no próximo ano?",
            "O que te inspira criativamente?",
            "Qual é a sua ideia de um encontro perfeito?",
            "O que você espera de um relacionamento amoroso?",
            "Como você expressa quando algo te incomoda?",
            "O que você gostaria que as pessoas lembrassem de você?",
            "Qual é o seu maior ponto forte?",
            "O que significa compromisso para você?",
            "Como você lida com mudanças inesperadas?",
            "O que te faz sentir seguro/a em um relacionamento?",
            "Qual é a sua forma de celebrar as vitórias?",
            "O que você está procurando nesta conexão entre nós?"
        ];

        function initializeGame() {
            const initialData = {
                NICOLAS: {},
                CAROLINA: {}
            };
            
            get(gameRef).then((snapshot) => {
                if (!snapshot.exists()) {
                    set(gameRef, initialData);
                }
            });
        }

        const connectedRef = ref(database, '.info/connected');
        onValue(connectedRef, (snapshot) => {
            const status = document.getElementById('connectionStatus');
            if (snapshot.val() === true) {
                status.textContent = 'Conectado 🟢';
                status.className = 'connection-status connected';
            } else {
                status.textContent = 'Desconectado 🔴';
                status.className = 'connection-status disconnected';
            }
        });

        window.selectUser = function(user) {
            currentUser = user;
            document.querySelectorAll('.user-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('statsContainer').style.display = 'block';
            loadQuestions();
        };

        onValue(gameRef, (snapshot) => {
            if (currentUser) {
                updateStats();
                renderQuestions();
                checkCompletion();
            }
        });

        function updateStats() {
            get(gameRef).then((snapshot) => {
                const data = snapshot.val() || { NICOLAS: {}, CAROLINA: {} };
                
                const nicolasCount = Object.keys(data.NICOLAS || {}).length;
                const carolinaCount = Object.keys(data.CAROLINA || {}).length;
                const unlocked = Math.min(nicolasCount, carolinaCount);
                
                document.getElementById('nicolasAnswers').textContent = nicolasCount;
                document.getElementById('carolinaAnswers').textContent = carolinaCount;
                document.getElementById('unlockedCount').textContent = unlocked;
                
                const progress = (unlocked / questions.length) * 100;
                document.getElementById('progressBar').style.width = progress + '%';
            });
        }

        function loadQuestions() {
            renderQuestions();
        }

        function renderQuestions() {
            get(gameRef).then((snapshot) => {
                const data = snapshot.val() || { NICOLAS: {}, CAROLINA: {} };
                const container = document.getElementById('questionsContainer');
                container.innerHTML = '';

                const otherUser = currentUser === 'NICOLAS' ? 'CAROLINA' : 'NICOLAS';
                const myAnswers = data[currentUser] || {};
                const theirAnswers = data[otherUser] || {};

                questions.forEach((question, index) => {
                    const questionNum = index + 1;
                    const myAnswer = myAnswers[questionNum];
                    const theirAnswer = theirAnswers[questionNum];
                    
                    const prevQuestionNum = questionNum - 1;
                    const isFirstQuestion = questionNum === 1;
                    const prevAnsweredByBoth = isFirstQuestion || 
                        (myAnswers[prevQuestionNum] && theirAnswers[prevQuestionNum]);

                    const card = document.createElement('div');
                    card.className = 'question-card' + (!prevAnsweredByBoth ? ' locked' : '');
                    
                    let html = `
                        <div class="question-number">Pergunta ${questionNum} de ${questions.length}</div>
                        <div class="question-text">${question}</div>
                    `;

                    if (!prevAnsweredByBoth) {
                        html += `
                            <div class="locked-message">
                                🔒 Esta pergunta será desbloqueada quando ambos responderem a anterior
                            </div>
                        `;
                    } else {
                        if (!myAnswer) {
                            html += `
                                <textarea id="answer-${questionNum}" placeholder="Escreva sua resposta aqui..."></textarea>
                                <button class="btn-submit" onclick="saveAnswer(${questionNum})">Enviar Resposta</button>
                            `;
                        } else {
                            html += `
                                <div class="answer-display">
                                    <div class="answer-label">Sua resposta:</div>
                                    <div class="answer-text">${myAnswer}</div>
                                </div>
                            `;

                            if (theirAnswer) {
                                html += `
                                    <div class="answer-display" style="margin-top: 10px;">
                                        <div class="answer-label">Resposta de ${otherUser === 'NICOLAS' ? 'Nicolás' : 'Carolina'}:</div>
                                        <div class="answer-text">${theirAnswer}</div>
                                    </div>
                                `;
                            } else {
                                html += `
                                    <div class="locked-message" style="margin-top: 10px;">
                                        ⏳ Aguardando resposta de ${otherUser === 'NICOLAS' ? 'Nicolás' : 'Carolina'}...
                                    </div>
                                `;
                            }
                        }
                    }

                    card.innerHTML = html;
                    container.appendChild(card);
                });

                updateStats();
            });
        }

        function checkCompletion() {
            get(gameRef).then((snapshot) => {
                const data = snapshot.val() || { NICOLAS: {}, CAROLINA: {} };
                const nicolasAnswers = data.NICOLAS || {};
                const carolinaAnswers = data.CAROLINA || {};
                
                const nicolasComplete = Object.keys(nicolasAnswers).length === questions.length;
                const carolinaComplete = Object.keys(carolinaAnswers).length === questions.length;
                
                if (nicolasComplete && carolinaComplete) {
                    showComparison(data);
                }
            });
        }

        function showComparison(data) {
            const container = document.getElementById('comparisonContainer');
            
            let html = `
                <div class="celebration">
                    <h2>🎉 Parabéns! 🎉</h2>
                    <p>Vocês completaram todas as 50 perguntas!</p>
                    <p>Aqui está a comparação de todas as suas respostas.</p>
                </div>
                <div class="comparison-section">
                    <div class="comparison-title">📊 Comparação Completa das Respostas</div>
            `;

            questions.forEach((question, index) => {
                const questionNum = index + 1;
                const nicolasAnswer = data.NICOLAS[questionNum] || 'Sem resposta';
                const carolinaAnswer = data.CAROLINA[questionNum] || 'Sem resposta';

                html += `
                    <div class="comparison-card">
                        <div class="comparison-question">${questionNum}. ${question}</div>
                        <div class="comparison-answers">
                            <div class="comparison-answer nicolas">
                                <div class="comparison-answer-label">🇦🇷 Nicolás:</div>
                                <div class="comparison-answer-text">${nicolasAnswer}</div>
                            </div>
                            <div class="comparison-answer carolina">
                                <div class="comparison-answer-label">🇧🇷 Carolina:</div>
                                <div class="comparison-answer-text">${carolinaAnswer}</div>
                            </div>
                        </div>
                    </div>
                `;
            });

            html += '</div>';
            container.innerHTML = html;
        }

        window.saveAnswer = function(questionNum) {
            const textarea = document.getElementById(`answer-${questionNum}`);
            const answer = textarea.value.trim();

            if (!answer) {
                alert('Por favor, escreva uma resposta');
                return;
            }

            const userAnswersRef = ref(database, `game/${currentUser}/${questionNum}`);
            
            set(userAnswersRef, answer)
                .then(() => {
                    renderQuestions();
                    checkCompletion();
                })
                .catch((error) => {
                    alert('Erro ao salvar: ' + error.message);
                });
        };

        window.addEventListener('load', () => {
            initializeGame();
        });
    </script>
</body>
</html>
